this.LIBRO=this.LIBRO||{},this.LIBRO.plusStore=function(t){"use strict";var e=function(){return(e=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var s in e=arguments[i])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};function i(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{c(n.next(t))}catch(t){r(t)}}function a(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))}function n(t,e){var i,n,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(s=2&r[0]?n.return:r[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,r[1])).done)return s;switch(n=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,n=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],n=0}finally{i=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}function s(){for(var e,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];c.debug&&(e=t.logger.tag("plus-store")).info.apply(e,function(t,e,i){if(i||2===arguments.length)for(var n,s=0,r=e.length;s<r;s++)!n&&s in e||(n||(n=Array.prototype.slice.call(e,0,s)),n[s]=e[s]);return t.concat(n||Array.prototype.slice.call(e))}([],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,s,r=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(n=r.next()).done;)o.push(n.value)}catch(t){s={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(s)throw s.error}}return o}(i),!1))}var r=new t.EventEmitter,o=new Map,a=new Map,c={debug:!1,ncid:"",lang:"en-US",product:{isrc:"",offerIds:[],programCode:"",businessUnit:"",tastemakerName:"",sku:"",contextSku:"",switchCategory:"",requestedAttributes:[]},widgets:{smartWidgetUrl:"https://s.aolcdn.com/membership/omp-static/omp-widgets/2.1.1/smart-widget.yahoo.prod.js",switchWidgetUrl:"https://s.aolcdn.com/membership/omp-static/omp-widgets/2.1.1/switch-widget.prod.js"},rapid:{spaceId:""},user:{logInUrl:"",logoutUrl:""}},d={user:{isAuthenticated:!1,allow_tandt:!1,user_loggedinalias:"",comscoreData:{cs_fpid:void 0,cs_fpdm:void 0,c14:void 0},ccpa:{url:"",label:"",warning:"",showDAAPrivacyRightsIcon:!1},ccpaIconUrl:"",privacyLinks:{warningMsg:"",links:{},footerSequence:[]},privacyIconUrl:"",logInUrl:"",logoutUrl:""},savingsPlan:{promo:{bmsm:{offerId:null,promoDesc:"",promoType:"",amount:0,campaignName:"",campaignDesc:""}},content:{bmsm:{}}},subscription:{content:{},subscriptionCategory:"",hasSwitchedPlan:!1,cpSku:""},offers:{userStatus:"",testCase:"",eligibleSubCount:0,eligibleSubs:"",ncid:""},request:{doneUrl:"",url:"",slug:"",ncid:"",feature:"",dspid:0,dspn:"",dspcid:""},ocmContent:{},mediaQueries:[{media:"(min-width: 768px)"},{media:"(min-width: 870px)"},{media:"(min-width: 900px)"}],hasSubscription:{contextSku:"",userSubscribed:!1}};function u(e){if(""===e)return e;var i=e;i=t.dataUtils.upsertQueryParam(i,"ncid",c.ncid),i=t.dataUtils.upsertQueryParam(i,"isrc",c.product.isrc);var n=d.request,s=n.doneUrl,r={ncid:n.ncid,varId:n.slug,done:s};return Object.keys(r).forEach((function(e){var n=t.dataUtils.sanitizeQueryParam(e,r[e]);n&&(i=t.dataUtils.upsertQueryParam(i,e,n))})),i}function l(e){var r,o,a,u,l;"user_logged_in_alias"in e&&(e.user_loggedinalias=e.user_logged_in_alias),t.dataUtils.copyObjectValues(d.user,e,!0,!0),e.privacyLinks&&(d.user.privacyLinks.links=e.privacyLinks.links),"user_loggedinalias"in e&&(d.user.isAuthenticated=!0,o=(r=c.product).offerIds,a=r.programCode,u=r.sku,(l={offerIds:o,businessUnit:r.businessUnit,programCode:a,productContentRequest:{sku:u,feature:"savings_program"}}).offerIds&&l.businessUnit&&l.programCode&&l.productContentRequest.sku&&window.OMP.smartWidget.getEligiblePromo(l),function(){var t=c.product,e=t.businessUnit,i=t.sku,n={businessUnit:e,contextSku:t.contextSku,productContentRequest:{sku:i,feature:"subscription_type"}};window.OMP.smartWidget.getSubscriptionCategory(n)}(),f(),function(){i(this,void 0,void 0,(function(){var e,i,r,o,a,d;return n(this,(function(n){switch(n.label){case 0:if(!(e=c.product.contextSku))return console.log("Exiting getSubType function: contextSku is missing"),[2];n.label=1;case 1:return n.trys.push([1,3,,4]),s("dispatcher > making call with contextSku: %s",e),[4,t.dispatcher.call("hasSubscriptions?contexts="+e)];case 2:return i=n.sent(),s("dispatcher > response received: %s",JSON.stringify(i)),r=i.statusCode,o=i.statusMessage,a=i.nameToContext,"200"===r&&"ok"===o?(d=a[e])&&d.offers&&d.offers.length>0?d.offers[0].subType.split(",").forEach((function(t){s("dispatcher > sub is %s",t)})):s("dispatcher > no subs found for contextSku: %s",e):s("dispatcher > status or message is bad. status: %s, message: %s",r,o),[3,4];case 3:return s("dispatcher > error fetching dispatcher offers: %s",n.sent().message),[3,4];case 4:return[2]}}))}))}(),function(){i(this,void 0,void 0,(function(){var e,i,r,o,a,u,l;return n(this,(function(n){switch(n.label){case 0:s("disp >> ncid %s",e=t.dataUtils.getQueryParam(window.location.search,"ncid")||window.LIBRO.content.attributes.ncid),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,t.dispatcher.call("extendedTrial?contexts=".concat(e))];case 2:return i=n.sent(),r=i.statusCode,o=i.statusMessage,a=i.nameToContext,"200"===r&&"ok"===o?(u=Object.values(a).find((function(t){return"200"===t.statusCode})),t.dataUtils.copyObjectValues(d.offers,u.offers[0]),s("disp >> offers >> %s",d.offers),"eligible"===d.offers.userStatus?(h("DISABLE_EXINT"),t.dom.getElement(".offers-comp")?(s("disp >> offers comp exists >> show all offers"),h("OFFERS_DATA",d.offers)):(s("disp >> offers comp is not present >> check for individual offer eligibility"),c.ncid=d.offers.ncid,d.request.ncid=d.offers.ncid,f=d.offers.eligibleSubs.split(","),g=window.LIBRO.content.attributes.offerid,w=f.find((function(t){return t===g}))||"",p({data:{subscriptionCategory:{attributes:{subscription_type:window.LIBRO.content.attributes.subscription_type},category:w,cpSku:"na",isPaused:!1}}}))):s("disp >> user is ineligible for offers")):console.error("Unexpected response: ".concat(r," - ").concat(o)),[3,4];case 3:return l=n.sent(),console.error("Error fetching dispatcher offers:",l),[3,4];case 4:return[2]}var f,g,w}))}))}()),h("USER_DATA",d.user)}function p(i){var n,r;s("Got subscription content: %s",i);var o,a=null===(r=null===(n=i.data)||void 0===n?void 0:n.subscriptionCategory)||void 0===r?void 0:r.attributes;if(a&&"subscription_type"in a)try{var c=t.dataReducers.reduceAttributeData(a.subscription_type,"subscription"),l=i.data.subscriptionCategory.category;t.dom.isWindowObject("window.YAHOO.rapidInstance")&&window.YAHOO.rapidInstance.setRapidAttribute({keys:{pl3:l}});var p=(o=c[l],t.dataUtils.updatePropertyValue(o,"cta_url",u));d.subscription.content=e(e({},d.subscription.content),p),d.subscription.subscriptionCategory=l,d.subscription.cpSku=i.data.subscriptionCategory.cpSku}catch(t){s("Error parsing subscription content: %s",t)}h("SUBSCRIPTION_CONTENT",d.subscription.content),h("SUBSCRIPTION_CATEGORY",d.subscription.subscriptionCategory)}function f(){var e=c.product,i={contextSku:e.contextSku,businessUnit:e.businessUnit};t.dom.isWindowObject("window.OMP.smartWidget")&&!0===window.OMP.smartWidget.isReady?window.OMP.smartWidget.getHasSubscription(i):a.set("getHasSubscription",i)}function g(i){if("string"!=typeof i&&i.message)switch(s("incoming message, event: %s, message: %s",i.status,i.message),i.status){case"USER_STATUS":l(i.message);break;case"ELIGIBLE_PROMO":!function(i){var n,r,o,a;s("Got eligibility data: %s",i);var u=null===(r=null===(n=i.data)||void 0===n?void 0:n.eligiblePromos)||void 0===r?void 0:r.attributes,l=null===(a=null===(o=i.data)||void 0===o?void 0:o.eligiblePromos)||void 0===a?void 0:a.eligibilityResult;if(u&&l&&"savings_program"in u&&l.length>0)try{var p=t.dataReducers.reduceAttributeData(u.savings_program,"savings_program_type"),f=c.product.offerIds[0],g=l.find((function(t){return t.offerId===f}));if(g){var w="".concat(100*g.amount,"%");d.savingsPlan.promo.bmsm=e(e({},d.savingsPlan.promo.bmsm),g);var m=t.dataUtils.replaceObjectPlaceholders(p,{discount:w});d.savingsPlan.content=e(e({},d.savingsPlan.content),m),t.dom.isWindowObject("window.YAHOO.rapidInstance")&&window.YAHOO.rapidInstance.setRapidAttribute({keys:{itmId:g.campaignName}})}else s("No matching promo for offer id: %s was found",f)}catch(t){console.log(t),s("Error parsing savings plan data: %s",t)}h("SAVINGS_PLAN_DATA",d.savingsPlan.content)}(i.message);break;case"SUBS_CATEGORY":p(i.message);break;case"OCM_CONTENT":!function(e){if(s("Got OCM content: %s",e),e)try{d.ocmContent=t.dataReducers.parseAttributeData(e.attributes)}catch(t){s("Error parsing OCM content: %s",t)}h("OCM_CONTENT",d.ocmContent)}(i.message);break;case"HAS_SUBSCRIPTION":!function(t){if(t)try{d.hasSubscription=t}catch(t){s("Error parsing IsSubscribed data: %s",t)}h("HAS_SUBSCRIPTION",d.hasSubscription)}(i.message);break;default:s(i)}}function w(t){var e;if("string"!=typeof t)switch(t.status){case"INIT_ERROR":h("SWITCH_LIGHTBOX_VISIBILITY","OFF"),s("Could not initialize switch widget");break;case"LIGHTBOX_HIDDEN":if(!0===d.subscription.hasSwitchedPlan){var i=null===(e=d.subscription.content.switch)||void 0===e?void 0:e.success_url;i?window.location.href=i:window.location.reload()}h("SWITCH_LIGHTBOX_VISIBILITY","OFF");break;case"SWITCH_SUCCESS":d.subscription.hasSwitchedPlan=!0}}function h(t,e){void 0===e&&(e=""),s("Emitting to page modules: %s with data: %s",t,e),o.set(t,e),r.emit(t,e)}function m(t){h("MEDIA_QUERY_LIST_EVENT",{matches:t.matches,media:t.media})}return t.dom.isWindowObject("window.LIBRO.config")?function(){i(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:t.dataUtils.copyObjectValues(c,window.LIBRO.config),n=encodeURIComponent(window.location.href),d.user.logInUrl=t.dataUtils.replacePlaceholders(c.user.logInUrl,{done:n,lang:c.lang,isrc:c.product.isrc}),d.user.logoutUrl=t.dataUtils.replacePlaceholders(c.user.logoutUrl,{done:n,lang:c.lang,isrc:c.product.isrc}),function(){var e=new URL(window.location.href),i=e.pathname,n=i.lastIndexOf("/")+1,s=i.slice(n),r=t.dataUtils.getQueryParam(window.location.search,"done");if(r)for(;r!==decodeURIComponent(r);)r=decodeURIComponent(r);var o=t.dataUtils.getQueryParam(window.location.search,"ncid"),a=t.dataUtils.getQueryParam(window.location.search,"feature"),c=t.dataUtils.getQueryParam(window.location.search,"dspid"),u=t.dataUtils.getQueryParam(window.location.search,"dspn"),l=t.dataUtils.getQueryParam(window.location.search,"dspcid");t.dataUtils.copyObjectValues(d.request,{url:e.href,doneUrl:r,slug:s,ncid:o,feature:a,dspid:c,dspn:u,dspcid:l}),h("URL_DATA",d.request)}(),i=function(){h("PAGE_LOADED",d),d.mediaQueries.forEach((function(t){t.mediaQueryList=window.matchMedia(t.media),t.mediaQueryList.addEventListener("change",m),m({matches:t.mediaQueryList.matches,media:t.media})}))},"interactive"===document.readyState||"complete"===document.readyState?i():window.addEventListener("DOMContentLoaded",(function(){i()})),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,t.dom.loadScript(c.widgets.smartWidgetUrl,"window.OMP.smartWidget")];case 2:return e.sent(),window.OMP.smartWidget.init({debug:c.debug}),window.OMP.smartWidget.once("READY",(function(){window.OMP.smartWidget.on("DATA",g),window.OMP.smartWidget.getUserStatus(),a.forEach((function(t,e){s("Executing queued up smart widget call: %s, with params: %s",e,t),window.OMP.smartWidget[e](t),a.delete(e)}))})),[3,4];case 3:return s(e.sent()),[2];case 4:return[2]}var i,n}))}))}():s("Error, missing LIBRO.config"),{on:function(t,e){s('Event handler registered for "on" %s',t),r.on(t,e),o.has(t)&&(s("Returning previously emitted data for event %s",t),e(o.get(t)))},emit:h,off:function(t,e){try{r.off(t,e),s("Event handler unsubscribed from %s",t)}catch(t){}},once:function(t,e){o.has(t)?(s('Returning previously emitted data for event %s, will not register "once" event handler',t),e(o.get(t))):(s('Event handler registered for "once" %s',t),r.once(t,e))},getData:function(){return JSON.parse(JSON.stringify({data:d,config:c}))},getOCMContent:function(e){return i(this,void 0,void 0,(function(){var i,s;return n(this,(function(n){return i=c.product.sku,s={contextSku:i,requestedAttributes:e},t.dom.isWindowObject("window.OMP.smartWidget")&&!0===window.OMP.smartWidget.isReady?window.OMP.smartWidget.getOCMContent(s):a.set("getOCMContent",s),[2]}))}))},showSwitchLightbox:function(){return i(this,void 0,void 0,(function(){var e,i;return n(this,(function(n){switch(n.label){case 0:e={sku:d.subscription.cpSku,ncid:c.ncid,spaceId:c.rapid.spaceId,switchCategory:c.product.switchCategory},h("SWITCH_LIGHTBOX_VISIBILITY","ON"),n.label=1;case 1:return n.trys.push([1,4,,5]),t.dom.isWindowObject("window.OMP.switchWidget")?[3,3]:(s("window.OMP.switchWidget does not exist, will load.."),[4,t.dom.loadScript(c.widgets.switchWidgetUrl,"window.OMP.switchWidget")]);case 2:n.sent(),n.label=3;case 3:return[3,5];case 4:return i=n.sent(),h("SWITCH_LIGHTBOX_VISIBILITY","OFF"),s(i),[2];case 5:if(!window.OMP.switchWidget.isInitialized){s("switchWidget is not initialized, will initialize..");try{window.OMP.switchWidget.init(e,{debug:c.debug,allowPopups:!0}),window.OMP.switchWidget.once("READY",(function(){window.OMP.switchWidget.showLightbox(e)})),window.OMP.switchWidget.on("DATA",w)}catch(t){h("SWITCH_LIGHTBOX_VISIBILITY","OFF"),s(t)}return[2]}return window.OMP.switchWidget.showLightbox(e),[2]}}))}))},hideSwitchLightbox:function(){window.OMP.switchWidget.hideLightbox()},getHasSubscription:f}}(LIBRO.common);